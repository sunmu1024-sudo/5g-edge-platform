<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能边缘计算平台 | 蚌埠学院</title>
    
    <!-- 外部库 -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 本地样式文件 -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/dashboard.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    <link rel="stylesheet" href="assets/fonts/custom-fonts.css">
</head>
<body>
    <!-- 全局加载指示器 -->
    <div id="global-loading" class="global-loading">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">正在连接传感器...</div>
        </div>
    </div>

    <!-- 添加设备模态框 -->
    <div id="addDeviceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加新设备</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="deviceForm">
                    <div class="form-group">
                        <label for="deviceName">设备名称</label>
                        <input type="text" id="deviceName" placeholder="输入设备名称" required>
                    </div>
                    <div class="form-group">
                        <label for="deviceType">设备类型</label>
                        <select id="deviceType" required>
                            <option value="">选择设备类型</option>
                            <option value="temperature">温度传感器</option>
                            <option value="humidity">湿度传感器</option>
                            <option value="light">光照传感器</option>
                            <option value="pressure">压力传感器</option>
                            <option value="camera">摄像头</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="deviceLocation">安装位置</label>
                        <input type="text" id="deviceLocation" placeholder="输入安装位置" required>
                    </div>
                    <div class="form-group">
                        <label for="deviceId">设备ID</label>
                        <input type="text" id="deviceId" placeholder="自动生成或手动输入">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('addDeviceModal')">取消</button>
                        <button type="submit" class="btn btn-primary">添加设备</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 添加节点模态框 -->
    <div id="addNodeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加边缘节点</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="nodeForm">
                    <div class="form-group">
                        <label for="nodeName">节点名称</label>
                        <input type="text" id="nodeName" placeholder="输入节点名称" required>
                    </div>
                    <div class="form-group">
                        <label for="nodeLocation">部署位置</label>
                        <input type="text" id="nodeLocation" placeholder="输入部署位置" required>
                    </div>
                    <div class="form-group">
                        <label for="nodeIP">IP地址</label>
                        <input type="text" id="nodeIP" placeholder="输入IP地址" required>
                    </div>
                    <div class="form-group">
                        <label for="nodeSpecs">节点规格</label>
                        <select id="nodeSpecs">
                            <option value="basic">基础型 (2核4G)</option>
                            <option value="standard">标准型 (4核8G)</option>
                            <option value="advanced">高级型 (8核16G)</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('addNodeModal')">取消</button>
                        <button type="submit" class="btn btn-primary">添加节点</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- AI分析模态框 -->
    <div id="aiAnalysisModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3><i class="fas fa-brain"></i> AI智能分析</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="ai-analysis-container">
                    <div class="ai-tabs">
                        <button class="ai-tab active" data-tab="prediction">数据预测</button>
                        <button class="ai-tab" data-tab="anomaly">异常检测</button>
                        <button class="ai-tab" data-tab="optimization">优化建议</button>
                    </div>
                    
                    <div class="ai-content">
                        <div id="prediction-tab" class="ai-tab-content active">
                            <h4>未来趋势预测</h4>
                            <div class="prediction-chart" id="predictionChart"></div>
                            <div class="prediction-stats">
                                <div class="prediction-item">
                                    <span class="prediction-label">预计1小时后温度</span>
                                    <span class="prediction-value">25.3°C</span>
                                </div>
                                <div class="prediction-item">
                                    <span class="prediction-label">预测准确率</span>
                                    <span class="prediction-value">94.2%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div id="anomaly-tab" class="ai-tab-content">
                            <h4>异常检测报告</h4>
                            <div class="anomaly-list">
                                <div class="anomaly-item">
                                    <i class="fas fa-exclamation-triangle warning"></i>
                                    <div class="anomaly-info">
                                        <div class="anomaly-title">温度异常波动</div>
                                        <div class="anomaly-desc">检测到温度在10分钟内上升3.2°C</div>
                                    </div>
                                    <span class="anomaly-time">2分钟前</span>
                                </div>
                                <div class="anomaly-item">
                                    <i class="fas fa-info-circle info"></i>
                                    <div class="anomaly-info">
                                        <div class="anomaly-title">湿度正常范围</div>
                                        <div class="anomaly-desc">当前湿度保持在健康范围内</div>
                                    </div>
                                    <span class="anomaly-time">5分钟前</span>
                                </div>
                            </div>
                        </div>
                        
                        <div id="optimization-tab" class="ai-tab-content">
                            <h4>系统优化建议</h4>
                            <div class="optimization-list">
                                <div class="optimization-item">
                                    <i class="fas fa-lightbulb"></i>
                                    <div class="optimization-content">
                                        <div class="optimization-title">能耗优化</div>
                                        <div class="optimization-desc">建议在夜间降低光照强度以节省能源</div>
                                    </div>
                                </div>
                                <div class="optimization-item">
                                    <i class="fas fa-thermometer-half"></i>
                                    <div class="optimization-content">
                                        <div class="optimization-title">温度调节</div>
                                        <div class="optimization-desc">检测到空调运行效率较低，建议维护</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- 智能侧边栏 -->
        <nav class="sidebar">
            <div class="logo">
                <h1>智能边缘计算平台</h1>
                <p>蚌埠学院 · 物联网工程实验室</p>
            </div>
            <ul class="nav-links">
                <li>
                    <a href="#dashboard" class="nav-item active" data-page="dashboard">
                        <span class="nav-icon"><i class="fas fa-chart-line"></i></span>
                        <span class="nav-text">系统概览</span>
                    </a>
                </li>
                <li>
                    <a href="#devices" class="nav-item" data-page="devices">
                        <span class="nav-icon"><i class="fas fa-microchip"></i></span>
                        <span class="nav-text">设备管理</span>
                        <span class="nav-badge" id="devices-badge">0</span>
                    </a>
                </li>
                <li>
                    <a href="#analytics" class="nav-item" data-page="analytics">
                        <span class="nav-icon"><i class="fas fa-chart-bar"></i></span>
                        <span class="nav-text">数据分析</span>
                    </a>
                </li>
                <li>
                    <a href="#edge-nodes" class="nav-item" data-page="edge-nodes">
                        <span class="nav-icon"><i class="fas fa-server"></i></span>
                        <span class="nav-text">边缘节点</span>
                        <span class="nav-badge" id="nodes-badge">0</span>
                    </a>
                </li>
                <li>
                    <a href="#warnings" class="nav-item" data-page="warnings">
                        <span class="nav-icon"><i class="fas fa-exclamation-triangle"></i></span>
                        <span class="nav-text">警告中心</span>
                        <span class="nav-badge" id="warnings-badge">0</span>
                    </a>
                </li>
                <li>
                    <a href="#system" class="nav-item" data-page="system">
                        <span class="nav-icon"><i class="fas fa-cog"></i></span>
                        <span class="nav-text">系统管理</span>
                    </a>
                </li>
            </ul>
            
            <!-- AI助手侧边栏 -->
            <div class="ai-assistant">
                <div class="ai-header">
                    <i class="fas fa-robot"></i>
                    <span>AI助手</span>
                </div>
                <button class="ai-action" onclick="openAIAnalysis()">
                    <i class="fas fa-brain"></i>
                    <span>智能分析</span>
                </button>
                <button class="ai-action" onclick="generateReport()">
                    <i class="fas fa-file-alt"></i>
                    <span>生成报告</span>
                </button>
            </div>
        </nav>

        <!-- 主内容区 -->
        <main class="main-content">
            <header class="header">
                <div class="header-left">
                    <button class="sidebar-toggle" onclick="toggleSidebar()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h2 id="page-title">物联网平台监控中心</h2>
                    <div id="sensor-connection-status" class="sensor-status disconnected">
                        <span class="status-indicator"></span>
                        <span>等待连接传感器</span>
                    </div>
                </div>
                <div class="header-actions">
                    <div class="search-box">
                        <input type="text" class="search-input" placeholder="搜索设备、节点、数据..." id="global-search">
                        <span class="search-icon"><i class="fas fa-search"></i></span>
                    </div>
                    <button class="theme-toggle" onclick="toggleTheme()">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="user-info" onclick="showUserMenu()">
                        <div class="user-avatar">孙</div>
                        <span>孙木</span>
                        <div class="status-indicator"></div>
                    </div>
                </div>
            </header>

            <div class="content">
                <!-- 系统概览页面 -->
                <div id="dashboard" class="page active">
                    <div class="dashboard-overview">
                        <!-- 统计卡片 -->
                        <div class="stats-grid">
                            <div class="stat-card success" data-target="devices">
                                <div class="stat-content">
                                    <div class="stat-icon">
                                        <i class="fas fa-microchip"></i>
                                    </div>
                                    <div class="stat-info">
                                        <div class="stat-value" id="online-devices-count">0</div>
                                        <div class="stat-label">在线设备</div>
                                        <div class="stat-trend">
                                            <span class="trend-up"><i class="fas fa-arrow-up"></i> 2.5%</span>
                                            <span>较昨日</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-card" data-target="edge-nodes">
                                <div class="stat-content">
                                    <div class="stat-icon">
                                        <i class="fas fa-server"></i>
                                    </div>
                                    <div class="stat-info">
                                        <div class="stat-value" id="nodes-status">0/0</div>
                                        <div class="stat-label">边缘节点</div>
                                        <div class="stat-trend">
                                            <span class="trend-up"><i class="fas fa-arrow-up"></i> 1.2%</span>
                                            <span>运行正常</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-card warning" data-target="analytics">
                                <div class="stat-content">
                                    <div class="stat-icon">
                                        <i class="fas fa-thermometer-half"></i>
                                    </div>
                                    <div class="stat-info">
                                        <div class="stat-value" id="avg-temperature">--°C</div>
                                        <div class="stat-label">平均温度</div>
                                        <div class="stat-trend">
                                            <span class="trend-down"><i class="fas fa-arrow-down"></i> 0.8%</span>
                                            <span>较稳定</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-card danger" data-target="warnings">
                                <div class="stat-content">
                                    <div class="stat-icon">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                    <div class="stat-info">
                                        <div class="stat-value" id="unresolved-warnings">0</div>
                                        <div class="stat-label">未处理警告</div>
                                        <div class="stat-trend">
                                            <span class="trend-down"><i class="fas fa-arrow-down"></i> 15%</span>
                                            <span>处理中</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- AI智能洞察 -->
                        <div class="ai-insights">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-brain"></i>
                                    AI智能洞察
                                </div>
                                <button class="btn btn-sm btn-primary" onclick="openAIAnalysis()">
                                    <i class="fas fa-chart-line"></i>
                                    <span>详细分析</span>
                                </button>
                            </div>
                            <div class="insights-grid">
                                <div class="insight-card">
                                    <div class="insight-icon prediction">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="insight-content">
                                        <div class="insight-title">温度趋势预测</div>
                                        <div class="insight-value">1小时后: 25.3°C</div>
                                        <div class="insight-desc">预计保持稳定</div>
                                    </div>
                                </div>
                                <div class="insight-card">
                                    <div class="insight-icon anomaly">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                    <div class="insight-content">
                                        <div class="insight-title">异常检测</div>
                                        <div class="insight-value">2个警告</div>
                                        <div class="insight-desc">需要关注</div>
                                    </div>
                                </div>
                                <div class="insight-card">
                                    <div class="insight-icon optimization">
                                        <i class="fas fa-lightbulb"></i>
                                    </div>
                                    <div class="insight-content">
                                        <div class="insight-title">优化建议</div>
                                        <div class="insight-value">3条建议</div>
                                        <div class="insight-desc">可提升能效</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 图表区域 -->
                        <div class="charts-grid">
                            <div class="chart-container">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-chart-line"></i>
                                        传感器数据趋势
                                    </div>
                                    <div class="sensor-status disconnected" id="chart1-status">
                                        <span class="status-indicator"></span>
                                        <span>等待真实数据</span>
                                    </div>
                                </div>
                                <div id="chart1" class="chart"></div>
                            </div>
                            <div class="chart-container">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-tachometer-alt"></i>
                                        节点资源监控
                                    </div>
                                    <div class="sensor-status disconnected" id="chart2-status">
                                        <span class="status-indicator"></span>
                                        <span>等待真实数据</span>
                                    </div>
                                </div>
                                <div id="chart2" class="chart"></div>
                            </div>
                        </div>

                        <!-- 实时监控 -->
                        <div class="realtime-monitor">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-stream"></i>
                                    实时数据流
                                </div>
                                <div class="action-buttons">
                                    <button class="btn btn-sm btn-primary" onclick="refreshRealtimeData()">
                                        <i class="fas fa-sync-alt"></i>
                                        <span>手动更新</span>
                                    </button>
                                    <button class="btn btn-sm btn-success" onclick="checkSystemStatus()">
                                        <i class="fas fa-info-circle"></i>
                                        <span>系统状态</span>
                                    </button>
                                    <button class="btn btn-sm btn-warning" onclick="exportData()">
                                        <i class="fas fa-download"></i>
                                        <span>导出数据</span>
                                    </button>
                                </div>
                            </div>
                            <div class="data-stream" id="realtime-data">
                                <div class="empty-state">
                                    <div class="empty-icon">
                                        <i class="fas fa-satellite-dish"></i>
                                    </div>
                                    <div class="empty-title">等待传感器数据</div>
                                    <div class="empty-description">
                                        正在连接后端服务器和传感器数据流...
                                    </div>
                                    <button class="btn btn-primary" onclick="refreshRealtimeData()">
                                        <i class="fas fa-plug"></i>
                                        <span>连接数据源</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 设备管理页面 -->
                <div id="devices" class="page">
                    <div class="devices-management">
                        <div class="page-header">
                            <div class="page-title">设备管理</div>
                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="openModal('addDeviceModal')">
                                    <i class="fas fa-plus"></i>
                                    <span>添加设备</span>
                                </button>
                                <button class="btn btn-success" onclick="refreshSensorData()">
                                    <i class="fas fa-sync-alt"></i>
                                    <span>刷新状态</span>
                                </button>
                                <button class="btn btn-warning" onclick="scanDevices()">
                                    <i class="fas fa-search"></i>
                                    <span>扫描设备</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="devices-overview">
                            <div class="device-type-card">
                                <div class="device-type-icon temperature">
                                    <i class="fas fa-thermometer-half"></i>
                                </div>
                                <div class="device-type-count" id="temp-device-count">0</div>
                                <div class="device-type-label">温度传感器</div>
                            </div>
                            <div class="device-type-card">
                                <div class="device-type-icon humidity">
                                    <i class="fas fa-tint"></i>
                                </div>
                                <div class="device-type-count" id="humidity-device-count">0</div>
                                <div class="device-type-label">湿度传感器</div>
                            </div>
                            <div class="device-type-card">
                                <div class="device-type-icon light">
                                    <i class="fas fa-sun"></i>
                                </div>
                                <div class="device-type-count" id="light-device-count">0</div>
                                <div class="device-type-label">光照传感器</div>
                            </div>
                        </div>
                        
                        <div class="devices-table">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-list"></i>
                                    传感器列表
                                </div>
                                <div class="action-buttons">
                                    <button class="btn btn-sm" onclick="exportDeviceData()">
                                        <i class="fas fa-download"></i>
                                        <span>导出数据</span>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="bulkOperations()">
                                        <i class="fas fa-cog"></i>
                                        <span>批量操作</span>
                                    </button>
                                </div>
                            </div>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>设备ID</th>
                                            <th>设备名称</th>
                                            <th>设备类型</th>
                                            <th>状态</th>
                                            <th>位置</th>
                                            <th>当前数值</th>
                                            <th>最后更新</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="devices-tbody">
                                        <!-- 设备数据将通过JavaScript动态生成 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 数据分析页面 -->
                <div id="analytics" class="page">
                    <div class="analytics-dashboard">
                        <div class="page-header">
                            <div class="page-title">数据分析</div>
                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="generateReport()">
                                    <i class="fas fa-chart-line"></i>
                                    <span>生成报告</span>
                                </button>
                                <button class="btn btn-success" onclick="exportAnalytics()">
                                    <i class="fas fa-download"></i>
                                    <span>导出分析</span>
                                </button>
                                <button class="btn btn-warning" onclick="openAIAnalysis()">
                                    <i class="fas fa-brain"></i>
                                    <span>AI分析</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="analytics-content">
                            <div class="analytics-grid">
                                <div class="analytics-card large">
                                    <div class="card-header">
                                        <div class="card-title">
                                            <i class="fas fa-chart-bar"></i>
                                            历史数据趋势
                                        </div>
                                        <select id="timeRange">
                                            <option value="1">最近1小时</option>
                                            <option value="24" selected>最近24小时</option>
                                            <option value="168">最近7天</option>
                                            <option value="720">最近30天</option>
                                        </select>
                                    </div>
                                    <div id="analyticsChart" class="chart"></div>
                                </div>
                                
                                <div class="analytics-sidebar">
                                    <div class="stats-card">
                                        <div class="stats-title">数据统计</div>
                                        <div class="stats-list">
                                            <div class="stat-item">
                                                <span class="stat-label">数据总量</span>
                                                <span class="stat-value" id="total-data">0</span>
                                            </div>
                                            <div class="stat-item">
                                                <span class="stat-label">平均温度</span>
                                                <span class="stat-value" id="avg-temp">--°C</span>
                                            </div>
                                            <div class="stat-item">
                                                <span class="stat-label">平均湿度</span>
                                                <span class="stat-value" id="avg-humidity">--%</span>
                                            </div>
                                            <div class="stat-item">
                                                <span class="stat-label">数据完整性</span>
                                                <span class="stat-value" id="data-integrity">--%</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="correlation-card">
                                        <div class="card-title">关联分析</div>
                                        <div class="correlation-chart" id="correlationChart"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 边缘节点页面 -->
                <div id="edge-nodes" class="page">
                    <div class="edge-nodes-management">
                        <div class="page-header">
                            <div class="page-title">边缘节点管理</div>
                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="openModal('addNodeModal')">
                                    <i class="fas fa-plus"></i>
                                    <span>添加节点</span>
                                </button>
                                <button class="btn btn-warning" onclick="syncNodes()">
                                    <i class="fas fa-sync-alt"></i>
                                    <span>同步状态</span>
                                </button>
                                <button class="btn btn-success" onclick="deployAI()">
                                    <i class="fas fa-brain"></i>
                                    <span>部署AI模型</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="nodes-grid">
                            <!-- 节点卡片将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>

                <!-- 警告中心页面 -->
                <div id="warnings" class="page">
                    <div class="warnings-management">
                        <div class="page-header">
                            <div class="page-title">警告中心</div>
                            <div class="action-buttons">
                                <button class="btn btn-danger" onclick="clearReadWarnings()">
                                    <i class="fas fa-trash"></i>
                                    <span>清空已读</span>
                                </button>
                                <button class="btn btn-primary" onclick="openAlertSettings()">
                                    <i class="fas fa-cog"></i>
                                    <span>告警设置</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="warnings-content">
                            <div class="warnings-stats">
                                <div class="warning-stat critical">
                                    <div class="stat-value" id="critical-warnings">0</div>
                                    <div class="stat-label">严重警告</div>
                                </div>
                                <div class="warning-stat warning">
                                    <div class="stat-value" id="warning-count">0</div>
                                    <div class="stat-label">一般警告</div>
                                </div>
                                <div class="warning-stat info">
                                    <div class="stat-value" id="info-warnings">0</div>
                                    <div class="stat-label">信息提示</div>
                                </div>
                            </div>
                            
                            <div class="warnings-list">
                                <!-- 警告列表将通过JavaScript动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 系统管理页面 -->
                <div id="system" class="page">
                    <div class="system-management">
                        <div class="page-header">
                            <div class="page-title">系统管理</div>
                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="saveConfig()">
                                    <i class="fas fa-save"></i>
                                    <span>保存配置</span>
                                </button>
                                <button class="btn btn-warning" onclick="restartServices()">
                                    <i class="fas fa-redo"></i>
                                    <span>重启服务</span>
                                </button>
                                <button class="btn btn-success" onclick="backupSystem()">
                                    <i class="fas fa-database"></i>
                                    <span>系统备份</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="system-content">
                            <div class="system-cards">
                                <div class="system-card">
                                    <div class="card-title">
                                        <i class="fas fa-cog"></i>
                                        系统设置
                                    </div>
                                    <div class="system-settings">
                                        <div class="setting-item">
                                            <label>数据保存周期</label>
                                            <select id="dataRetention">
                                                <option value="7">7天</option>
                                                <option value="30" selected>30天</option>
                                                <option value="90">90天</option>
                                                <option value="365">1年</option>
                                            </select>
                                        </div>
                                        <div class="setting-item">
                                            <label>数据更新频率</label>
                                            <select id="updateFrequency">
                                                <option value="1">1秒</option>
                                                <option value="3" selected>3秒</option>
                                                <option value="5">5秒</option>
                                                <option value="10">10秒</option>
                                            </select>
                                        </div>
                                        <div class="setting-item">
                                            <label>AI分析启用</label>
                                            <label class="switch">
                                                <input type="checkbox" id="aiEnabled" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="system-card">
                                    <div class="card-title">
                                        <i class="fas fa-shield-alt"></i>
                                        安全设置
                                    </div>
                                    <div class="security-settings">
                                        <div class="setting-item">
                                            <label>访问权限控制</label>
                                            <label class="switch">
                                                <input type="checkbox" id="accessControl" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        <div class="setting-item">
                                            <label>数据加密</label>
                                            <label class="switch">
                                                <input type="checkbox" id="dataEncryption" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        <div class="setting-item">
                                            <label>审计日志</label>
                                            <label class="switch">
                                                <input type="checkbox" id="auditLog" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="system-info">
                                <div class="info-card">
                                    <div class="card-title">系统信息</div>
                                    <div class="info-list">
                                        <div class="info-item">
                                            <span class="info-label">平台版本</span>
                                            <span class="info-value">v2.0.0</span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">运行时间</span>
                                            <span class="info-value" id="uptime">--</span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">存储使用</span>
                                            <span class="info-value" id="storageUsage">--</span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">最后备份</span>
                                            <span class="info-value" id="lastBackup">--</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 智能通知 -->
    <div id="smart-notifications"></div>

    <!-- 本地脚本文件 -->
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/charts.js"></script>
    <script src="assets/js/notifications.js"></script>
    <script src="assets/js/ai.js"></script>

    <!-- 主应用脚本 -->
    <script>
// ==================== 平台核心引擎 ====================
class EdgePlatform {
    constructor() {
        this.apiBase = 'http://localhost:5000/api';
        this.charts = {};
        this.sensorData = {};
        this.nodeData = {};
        this.warnings = [];
        this.currentTheme = 'light';
        this.aiEnabled = true;
        this.init();
    }

    async init() {
        this.setupEventListeners();
        this.initCharts();
        this.loadTheme();
        this.initModals();
        await this.loadInitialData();
        this.startAutoRefresh();
        this.initAIFeatures();
    }

    setupEventListeners() {
        // 搜索功能
        document.getElementById('global-search').addEventListener('input', PlatformUtils.debounce((e) => {
            this.globalSearch(e.target.value);
        }, 300));

        // 表单提交
        document.getElementById('deviceForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.addNewDevice();
        });

        document.getElementById('nodeForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.addNewNode();
        });

        // AI标签切换
        document.querySelectorAll('.ai-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-tab');
                this.switchAITab(tabName);
            });
        });

        // 时间范围选择
        document.getElementById('timeRange').addEventListener('change', (e) => {
            this.updateAnalyticsChart(e.target.value);
        });
    }

    initModals() {
        // 关闭模态框事件
        document.querySelectorAll('.modal .close').forEach(closeBtn => {
            closeBtn.addEventListener('click', function() {
                this.closest('.modal').style.display = 'none';
            });
        });

        // 点击模态框外部关闭
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });
    }

    initCharts() {
        // 初始化所有图表
        this.initDashboardCharts();
        this.initAnalyticsChart();
        this.initCorrelationChart();
        this.initPredictionChart();
    }

    initDashboardCharts() {
        // 传感器数据趋势图
        const chart1 = echarts.init(document.getElementById('chart1'));
        this.charts.chart1 = chart1;
        
        const emptyChartOption = {
            title: { 
                text: '等待传感器数据', 
                left: 'center', 
                top: 'center',
                textStyle: { 
                    color: 'var(--text-secondary)',
                    fontSize: 16
                } 
            },
            graphic: {
                type: 'text',
                left: 'center',
                top: '45%',
                style: {
                    text: '连接数据源以查看实时趋势',
                    fontSize: 14,
                    fill: 'var(--text-secondary)',
                    textAlign: 'center'
                }
            },
            xAxis: { show: false },
            yAxis: { show: false },
            series: []
        };
        
        chart1.setOption(emptyChartOption);

        // 节点资源监控图
        const chart2 = echarts.init(document.getElementById('chart2'));
        this.charts.chart2 = chart2;
        chart2.setOption(emptyChartOption);
    }

    initAnalyticsChart() {
        const chart = echarts.init(document.getElementById('analyticsChart'));
        this.charts.analyticsChart = chart;
        
        const option = {
            title: {
                text: '传感器数据历史趋势',
                left: 'center',
                textStyle: { color: 'var(--text-primary)' }
            },
            tooltip: {
                trigger: 'axis',
                backgroundColor: 'var(--bg-primary)',
                borderColor: 'var(--border-light)',
                textStyle: { color: 'var(--text-primary)' }
            },
            legend: {
                data: ['温度', '湿度', '光照'],
                textStyle: { color: 'var(--text-secondary)' },
                top: 30
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                top: 80,
                containLabel: true
            },
            xAxis: {
                type: 'time',
                axisLine: { lineStyle: { color: 'var(--border-light)' } },
                axisLabel: { color: 'var(--text-secondary)' }
            },
            yAxis: [
                {
                    type: 'value',
                    name: '温度 (°C)',
                    axisLine: { lineStyle: { color: 'var(--border-light)' } },
                    axisLabel: { color: 'var(--text-secondary)' },
                    splitLine: { lineStyle: { color: 'var(--border-light)', opacity: 0.3 } }
                },
                {
                    type: 'value',
                    name: '湿度 (%)',
                    axisLine: { lineStyle: { color: 'var(--border-light)' } },
                    axisLabel: { color: 'var(--text-secondary)' },
                    splitLine: { show: false }
                }
            ],
            series: [
                {
                    name: '温度',
                    type: 'line',
                    yAxisIndex: 0,
                    data: this.generateSampleData('temperature', 24),
                    smooth: true,
                    itemStyle: { color: '#e74c3c' },
                    lineStyle: { width: 3 }
                },
                {
                    name: '湿度',
                    type: 'line',
                    yAxisIndex: 1,
                    data: this.generateSampleData('humidity', 24),
                    smooth: true,
                    itemStyle: { color: '#3498db' },
                    lineStyle: { width: 3 }
                },
                {
                    name: '光照',
                    type: 'line',
                    yAxisIndex: 0,
                    data: this.generateSampleData('light', 24),
                    smooth: true,
                    itemStyle: { color: '#f39c12' },
                    lineStyle: { width: 3 }
                }
            ]
        };
        
        chart.setOption(option);
    }

    initCorrelationChart() {
        const chart = echarts.init(document.getElementById('correlationChart'));
        this.charts.correlationChart = chart;
        
        const option = {
            title: {
                text: '温度-湿度关联',
                left: 'center',
                textStyle: { fontSize: 12, color: 'var(--text-secondary)' }
            },
            xAxis: {
                type: 'value',
                name: '温度 (°C)',
                nameTextStyle: { color: 'var(--text-secondary)' },
                axisLine: { lineStyle: { color: 'var(--border-light)' } },
                axisLabel: { color: 'var(--text-secondary)' }
            },
            yAxis: {
                type: 'value',
                name: '湿度 (%)',
                nameTextStyle: { color: 'var(--text-secondary)' },
                axisLine: { lineStyle: { color: 'var(--border-light)' } },
                axisLabel: { color: 'var(--text-secondary)' }
            },
            series: [{
                type: 'scatter',
                data: this.generateCorrelationData(),
                itemStyle: {
                    color: function(params) {
                        const temp = params.data[0];
                        return temp > 25 ? '#e74c3c' : temp > 20 ? '#3498db' : '#2ecc71';
                    }
                },
                symbolSize: 8
            }],
            grid: {
                left: '15%',
                right: '15%',
                bottom: '20%',
                top: '20%'
            }
        };
        
        chart.setOption(option);
    }

    initPredictionChart() {
        const chart = echarts.init(document.getElementById('predictionChart'));
        this.charts.predictionChart = chart;
        
        const option = {
            title: {
                text: '温度预测趋势',
                left: 'center',
                textStyle: { fontSize: 14, color: 'var(--text-primary)' }
            },
            tooltip: {
                trigger: 'axis',
                backgroundColor: 'var(--bg-primary)',
                borderColor: 'var(--border-light)',
                textStyle: { color: 'var(--text-primary)' }
            },
            xAxis: {
                type: 'category',
                data: ['当前', '15分钟后', '30分钟后', '45分钟后', '1小时后'],
                axisLine: { lineStyle: { color: 'var(--border-light)' } },
                axisLabel: { color: 'var(--text-secondary)' }
            },
            yAxis: {
                type: 'value',
                name: '温度 (°C)',
                axisLine: { lineStyle: { color: 'var(--border-light)' } },
                axisLabel: { color: 'var(--text-secondary)' },
                splitLine: { lineStyle: { color: 'var(--border-light)', opacity: 0.3 } }
            },
            series: [{
                name: '预测温度',
                type: 'line',
                data: [23.5, 23.8, 24.1, 24.3, 24.5],
                smooth: true,
                itemStyle: { color: '#9b59b6' },
                lineStyle: { width: 3 },
                markPoint: {
                    data: [
                        { type: 'max', name: '最高值' },
                        { type: 'min', name: '最低值' }
                    ]
                }
            }],
            grid: {
                left: '10%',
                right: '10%',
                bottom: '15%',
                top: '20%'
            }
        };
        
        chart.setOption(option);
    }

    initAIFeatures() {
        // 初始化AI功能
        if (this.aiEnabled) {
            this.startAIMonitoring();
        }
    }

    async loadInitialData() {
        try {
            this.showLoading('正在初始化平台...');
            
            // 模拟加载传感器数据
            await this.loadSensorData();
            
            // 模拟加载节点数据
            await this.loadNodeData();
            
            // 加载警告数据
            await this.loadWarnings();
            
            this.updateAllDisplays();
            this.hideLoading();
            
            this.showNotification('系统就绪', '平台初始化完成', 'success');
            
        } catch (error) {
            console.error('加载初始数据失败:', error);
            this.showNotification('连接失败', '无法连接到后端服务器', 'error');
            this.hideLoading();
        }
    }

    async loadSensorData() {
        // 模拟API调用
        return new Promise((resolve) => {
            setTimeout(() => {
                this.sensorData = {
                    'temp_001': {
                        id: 'temp_001',
                        name: '温度传感器-01',
                        type: 'temperature',
                        location: '实验室A区',
                        current_value: 23.5,
                        status: 'online',
                        unit: '°C',
                        last_update: new Date().toISOString(),
                        history: this.generateSampleData('temperature', 10)
                    },
                    'humidity_001': {
                        id: 'humidity_001',
                        name: '湿度传感器-01',
                        type: 'humidity',
                        location: '实验室A区',
                        current_value: 55.2,
                        status: 'online',
                        unit: '%',
                        last_update: new Date().toISOString(),
                        history: this.generateSampleData('humidity', 10)
                    },
                    'light_001': {
                        id: 'light_001',
                        name: '光照传感器-01',
                        type: 'light',
                        location: '实验室B区',
                        current_value: 450,
                        status: 'online',
                        unit: 'lux',
                        last_update: new Date().toISOString(),
                        history: this.generateSampleData('light', 10)
                    }
                };
                resolve();
            }, 1000);
        });
    }

    async loadNodeData() {
        // 模拟节点数据
        return new Promise((resolve) => {
            setTimeout(() => {
                this.nodeData = {
                    'node_001': {
                        id: 'node_001',
                        name: '边缘节点-01',
                        location: '实验室中心',
                        ip_address: '192.168.1.100',
                        status: 'online',
                        cpu_usage: 45,
                        memory_usage: 60,
                        connected_sensors: 3,
                        last_active: new Date().toISOString(),
                        specs: '标准型 (4核8G)'
                    },
                    'node_002': {
                        id: 'node_002',
                        name: '边缘节点-02',
                        location: '实验室北区',
                        ip_address: '192.168.1.101',
                        status: 'online',
                        cpu_usage: 30,
                        memory_usage: 45,
                        connected_sensors: 2,
                        last_active: new Date().toISOString(),
                        specs: '基础型 (2核4G)'
                    }
                };
                resolve();
            }, 500);
        });
    }

    async loadWarnings() {
        // 模拟警告数据
        this.warnings = [
            {
                id: 'warn_001',
                type: 'warning',
                title: '温度异常波动',
                message: '检测到温度在10分钟内上升3.2°C',
                sensor_id: 'temp_001',
                timestamp: new Date(Date.now() - 2 * 60000).toISOString(),
                resolved: false
            },
            {
                id: 'warn_002',
                type: 'info',
                title: '设备连接正常',
                message: '所有传感器连接稳定',
                timestamp: new Date(Date.now() - 5 * 60000).toISOString(),
                resolved: true
            }
        ];
    }

    updateAllDisplays() {
        this.updateStats();
        this.updateRealtimeDisplay();
        this.updateDeviceTable();
        this.updateDeviceCounts();
        this.updateNodeDisplay();
        this.updateWarningsDisplay();
        this.updateSystemInfo();
        this.updateChartsWithRealData();
    }

    updateStats() {
        const sensors = Object.values(this.sensorData);
        const nodes = Object.values(this.nodeData);
        
        const onlineSensors = sensors.filter(s => s.status === 'online').length;
        const onlineNodes = nodes.filter(n => n.status === 'online').length;
        
        // 计算平均温度
        const tempSensors = sensors.filter(s => s.type === 'temperature' && s.status === 'online');
        const avgTemp = tempSensors.length > 0 ? 
            (tempSensors.reduce((sum, s) => sum + (s.current_value || 0), 0) / tempSensors.length).toFixed(1) : '--';

        document.getElementById('online-devices-count').textContent = onlineSensors;
        document.getElementById('nodes-status').textContent = `${onlineNodes}/${nodes.length}`;
        document.getElementById('avg-temperature').textContent = avgTemp + '°C';
        
        // 更新徽章
        document.getElementById('devices-badge').textContent = sensors.length - onlineSensors;
        document.getElementById('nodes-badge').textContent = nodes.length - onlineNodes;
        
        // 更新警告统计
        const criticalWarnings = this.warnings.filter(w => w.type === 'critical' && !w.resolved).length;
        const warningCount = this.warnings.filter(w => w.type === 'warning' && !w.resolved).length;
        const infoWarnings = this.warnings.filter(w => w.type === 'info' && !w.resolved).length;
        
        document.getElementById('critical-warnings').textContent = criticalWarnings;
        document.getElementById('warning-count').textContent = warningCount;
        document.getElementById('info-warnings').textContent = infoWarnings;
        document.getElementById('unresolved-warnings').textContent = criticalWarnings + warningCount;
    }

    updateRealtimeDisplay() {
        const container = document.getElementById('realtime-data');
        if (!container) return;

        const sensors = Object.values(this.sensorData);
        
        if (sensors.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-satellite-dish"></i>
                    </div>
                    <div class="empty-title">暂无传感器数据</div>
                    <div class="empty-description">
                        等待传感器连接和数据传输...
                    </div>
                    <button class="btn btn-primary" onclick="platform.refreshSensorData()">
                        <i class="fas fa-plug"></i>
                        <span>重新连接</span>
                    </button>
                </div>
            `;
            return;
        }

        container.innerHTML = sensors.map(sensor => {
            const valueClass = this.getValueStatusClass(sensor);
            const timeText = PlatformUtils.formatTime(sensor.last_update);
            const icon = PlatformUtils.getSensorIcon(sensor.type);
            
            return `
            <div class="data-item">
                <div class="sensor-info">
                    <div class="sensor-icon"><i class="${icon}"></i></div>
                    <div class="sensor-details">
                        <div class="sensor-name">${sensor.name}</div>
                        <div class="sensor-location">${sensor.location}</div>
                    </div>
                </div>
                <div class="sensor-value ${valueClass}">
                    ${PlatformUtils.formatValue(sensor.current_value, sensor.unit)}
                </div>
                <div class="sensor-time">
                    ${timeText}
                </div>
            </div>
        `}).join('');
    }

    updateDeviceTable() {
        const tbody = document.getElementById('devices-tbody');
        if (!tbody) return;

        const sensors = Object.values(this.sensorData);
        
        if (sensors.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="8" style="text-align: center; padding: 60px;">
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-microchip"></i>
                            </div>
                            <div class="empty-title">暂无设备数据</div>
                            <div class="empty-description">
                                等待设备注册和数据采集...
                            </div>
                        </div>
                    </td>
                </tr>
            `;
            return;
        }

        tbody.innerHTML = sensors.map(sensor => {
            const valueClass = this.getValueStatusClass(sensor);
            const timeText = PlatformUtils.formatTime(sensor.last_update);
            const icon = PlatformUtils.getSensorIcon(sensor.type);
            
            return `
            <tr>
                <td><code>${sensor.id}</code></td>
                <td>
                    <div class="sensor-info">
                        <div class="sensor-icon"><i class="${icon}"></i></div>
                        <div class="sensor-details">
                            <div class="sensor-name">${sensor.name}</div>
                            <div class="sensor-location">${sensor.location}</div>
                        </div>
                    </div>
                </td>
                <td>${this.getDeviceTypeName(sensor.type)}</td>
                <td>
                    <span class="status-badge ${sensor.status === 'online' ? 'status-online' : 'status-offline'}">
                        <i class="fas fa-circle"></i>
                        ${sensor.status === 'online' ? '在线' : '离线'}
                    </span>
                </td>
                <td>${sensor.location}</td>
                <td class="${valueClass}">
                    ${PlatformUtils.formatValue(sensor.current_value, sensor.unit)}
                </td>
                <td>${timeText}</td>
                <td>
                    <div class="node-actions">
                        <button class="btn btn-sm btn-primary" onclick="platform.showDeviceDetail('${sensor.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm" onclick="platform.showDeviceConfig('${sensor.id}')">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="platform.removeDevice('${sensor.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
        `}).join('');
    }

    updateDeviceCounts() {
        const sensors = Object.values(this.sensorData);
        
        const tempCount = sensors.filter(s => s.type === 'temperature').length;
        const humidityCount = sensors.filter(s => s.type === 'humidity').length;
        const lightCount = sensors.filter(s => s.type === 'light').length;
        
        document.getElementById('temp-device-count').textContent = tempCount;
        document.getElementById('humidity-device-count').textContent = humidityCount;
        document.getElementById('light-device-count').textContent = lightCount;
    }

    updateNodeDisplay() {
        const container = document.querySelector('.nodes-grid');
        if (!container) return;

        const nodes = Object.values(this.nodeData);
        
        if (nodes.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-server"></i>
                    </div>
                    <div class="empty-title">暂无边缘节点</div>
                    <div class="empty-description">
                        点击"添加节点"来部署新的边缘计算节点
                    </div>
                    <button class="btn btn-primary" onclick="openModal('addNodeModal')">
                        <i class="fas fa-plus"></i>
                        <span>添加节点</span>
                    </button>
                </div>
            `;
            return;
        }

        container.innerHTML = nodes.map(node => {
            const statusClass = node.status === 'online' ? 'status-online' : 'status-offline';
            const cpuClass = node.cpu_usage > 80 ? 'danger' : node.cpu_usage > 60 ? 'warning' : 'success';
            const memoryClass = node.memory_usage > 80 ? 'danger' : node.memory_usage > 60 ? 'warning' : 'success';
            
            return `
            <div class="node-card">
                <div class="node-header">
                    <div class="node-title">${node.name}</div>
                    <span class="node-status ${statusClass}">
                        <i class="fas fa-circle"></i>
                        ${node.status === 'online' ? '在线' : '离线'}
                    </span>
                </div>
                <div class="node-info">
                    <div class="node-info-item">
                        <span class="node-info-label">位置</span>
                        <span class="node-info-value">${node.location}</span>
                    </div>
                    <div class="node-info-item">
                        <span class="node-info-label">IP地址</span>
                        <span class="node-info-value">${node.ip_address}</span>
                    </div>
                    <div class="node-info-item">
                        <span class="node-info-label">规格</span>
                        <span class="node-info-value">${node.specs}</span>
                    </div>
                    <div class="node-info-item">
                        <span class="node-info-label">连接传感器</span>
                        <span class="node-info-value">${node.connected_sensors} 个</span>
                    </div>
                    <div class="node-info-item">
                        <span class="node-info-label">CPU使用率</span>
                        <span class="node-info-value ${cpuClass}">${node.cpu_usage}%</span>
                    </div>
                    <div class="node-info-item">
                        <span class="node-info-label">内存使用率</span>
                        <span class="node-info-value ${memoryClass}">${node.memory_usage}%</span>
                    </div>
                </div>
                <div class="node-actions">
                    <button class="btn btn-sm btn-primary" onclick="platform.manageNode('${node.id}')">
                        <i class="fas fa-cog"></i>
                        <span>管理</span>
                    </button>
                    <button class="btn btn-sm btn-warning" onclick="platform.restartNode('${node.id}')">
                        <i class="fas fa-redo"></i>
                        <span>重启</span>
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="platform.removeNode('${node.id}')">
                        <i class="fas fa-trash"></i>
                        <span>删除</span>
                    </button>
                </div>
            </div>
        `}).join('');
    }

    updateWarningsDisplay() {
        const container = document.querySelector('.warnings-list');
        if (!container) return;

        const unresolvedWarnings = this.warnings.filter(w => !w.resolved);
        
        if (unresolvedWarnings.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="empty-title">暂无未处理警告</div>
                    <div class="empty-description">
                        所有系统运行正常，没有需要处理的警告
                    </div>
                </div>
            `;
            return;
        }

        container.innerHTML = unresolvedWarnings.map(warning => {
            const typeClass = `warning-${warning.type}`;
            const icon = warning.type === 'critical' ? 'fa-exclamation-circle' : 
                        warning.type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle';
            
            return `
            <div class="warning-item ${typeClass}">
                <div class="warning-header">
                    <i class="fas ${icon} warning-icon"></i>
                    <div class="warning-title">${warning.title}</div>
                    <span class="warning-time">${PlatformUtils.formatTime(warning.timestamp)}</span>
                </div>
                <div class="warning-content">
                    <div class="warning-message">${warning.message}</div>
                    ${warning.sensor_id ? `<div class="warning-source">来源: ${warning.sensor_id}</div>` : ''}
                </div>
                <div class="warning-actions">
                    <button class="btn btn-sm btn-primary" onclick="platform.resolveWarning('${warning.id}')">
                        <i class="fas fa-check"></i>
                        <span>标记已处理</span>
                    </button>
                    <button class="btn btn-sm" onclick="platform.viewWarningDetails('${warning.id}')">
                        <i class="fas fa-search"></i>
                        <span>查看详情</span>
                    </button>
                </div>
            </div>
        `}).join('');
    }

    updateSystemInfo() {
        // 更新系统信息
        document.getElementById('uptime').textContent = this.formatUptime();
        document.getElementById('storageUsage').textContent = '1.2 GB / 10 GB';
        document.getElementById('lastBackup').textContent = PlatformUtils.formatTime(new Date(Date.now() - 2 * 3600000));
        
        // 更新数据统计
        document.getElementById('total-data').textContent = '1,248 条';
        document.getElementById('avg-temp').textContent = '23.5°C';
        document.getElementById('avg-humidity').textContent = '55.2%';
        document.getElementById('data-integrity').textContent = '98.7%';
    }

    updateChartsWithRealData() {
        // 使用真实数据更新图表
        this.updateDashboardCharts();
    }

    updateDashboardCharts() {
        // 更新仪表板图表
        if (this.charts.chart1 && Object.keys(this.sensorData).length > 0) {
            const option = {
                title: {
                    text: '传感器数据实时趋势',
                    left: 'center',
                    textStyle: { color: 'var(--text-primary)' }
                },
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'var(--bg-primary)',
                    borderColor: 'var(--border-light)',
                    textStyle: { color: 'var(--text-primary)' }
                },
                legend: {
                    data: Object.values(this.sensorData).map(s => s.name),
                    textStyle: { color: 'var(--text-secondary)' }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'time',
                    axisLine: { lineStyle: { color: 'var(--border-light)' } },
                    axisLabel: { color: 'var(--text-secondary)' }
                },
                yAxis: {
                    type: 'value',
                    axisLine: { lineStyle: { color: 'var(--border-light)' } },
                    axisLabel: { color: 'var(--text-secondary)' },
                    splitLine: { lineStyle: { color: 'var(--border-light)', opacity: 0.3 } }
                },
                series: Object.values(this.sensorData).map(sensor => ({
                    name: sensor.name,
                    type: 'line',
                    data: sensor.history,
                    smooth: true,
                    symbol: 'none',
                    lineStyle: { width: 2 }
                }))
            };
            
            this.charts.chart1.setOption(option);
            
            // 更新图表状态
            const statusElement = document.getElementById('chart1-status');
            if (statusElement) {
                statusElement.className = 'sensor-status connected';
                statusElement.innerHTML = '<span class="status-indicator"></span><span>实时数据更新中</span>';
            }
        }

        // 更新节点资源图表
        if (this.charts.chart2 && Object.keys(this.nodeData).length > 0) {
            const nodes = Object.values(this.nodeData);
            const option = {
                title: {
                    text: '节点资源使用情况',
                    left: 'center',
                    textStyle: { color: 'var(--text-primary)' }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'shadow' },
                    backgroundColor: 'var(--bg-primary)',
                    borderColor: 'var(--border-light)',
                    textStyle: { color: 'var(--text-primary)' }
                },
                legend: {
                    data: ['CPU使用率', '内存使用率'],
                    textStyle: { color: 'var(--text-secondary)' }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: nodes.map(n => n.name),
                    axisLine: { lineStyle: { color: 'var(--border-light)' } },
                    axisLabel: { 
                        color: 'var(--text-secondary)',
                        rotate: 45
                    }
                },
                yAxis: {
                    type: 'value',
                    max: 100,
                    axisLine: { lineStyle: { color: 'var(--border-light)' } },
                    axisLabel: { 
                        color: 'var(--text-secondary)',
                        formatter: '{value}%'
                    },
                    splitLine: { lineStyle: { color: 'var(--border-light)', opacity: 0.3 } }
                },
                series: [
                    {
                        name: 'CPU使用率',
                        type: 'bar',
                        data: nodes.map(n => ({
                            value: n.cpu_usage,
                            itemStyle: {
                                color: n.cpu_usage > 80 ? '#e74c3c' : n.cpu_usage > 60 ? '#f39c12' : '#2ecc71'
                            }
                        })),
                        barWidth: '30%'
                    },
                    {
                        name: '内存使用率',
                        type: 'bar',
                        data: nodes.map(n => ({
                            value: n.memory_usage,
                            itemStyle: {
                                color: n.memory_usage > 80 ? '#e74c3c' : n.memory_usage > 60 ? '#f39c12' : '#3498db'
                            }
                        })),
                        barWidth: '30%'
                    }
                ]
            };
            
            this.charts.chart2.setOption(option);
            
            // 更新图表状态
            const statusElement = document.getElementById('chart2-status');
            if (statusElement) {
                statusElement.className = 'sensor-status connected';
                statusElement.innerHTML = '<span class="status-indicator"></span><span>实时数据更新中</span>';
            }
        }
    }

    // 设备管理方法
    addNewDevice() {
        const name = document.getElementById('deviceName').value;
        const type = document.getElementById('deviceType').value;
        const location = document.getElementById('deviceLocation').value;
        const id = document.getElementById('deviceId').value || `sensor_${Date.now()}`;

        if (!name || !type || !location) {
            this.showNotification('错误', '请填写所有必填字段', 'error');
            return;
        }

        // 创建新设备
        const newDevice = {
            id: id,
            name: name,
            type: type,
            location: location,
            current_value: this.getDefaultValue(type),
            status: 'online',
            unit: this.getUnit(type),
            last_update: new Date().toISOString(),
            history: this.generateSampleData(type, 5)
        };

        this.sensorData[id] = newDevice;
        
        // 关闭模态框
        this.closeModal('addDeviceModal');
        
        // 重置表单
        document.getElementById('deviceForm').reset();
        
        // 更新显示
        this.updateAllDisplays();
        
        this.showNotification('成功', `设备 ${name} 已添加`, 'success');
    }

    addNewNode() {
        const name = document.getElementById('nodeName').value;
        const location = document.getElementById('nodeLocation').value;
        const ip = document.getElementById('nodeIP').value;
        const specs = document.getElementById('nodeSpecs').value;

        if (!name || !location || !ip) {
            this.showNotification('错误', '请填写所有必填字段', 'error');
            return;
        }

        // 创建新节点
        const newNode = {
            id: `node_${Date.now()}`,
            name: name,
            location: location,
            ip_address: ip,
            status: 'online',
            cpu_usage: Math.floor(Math.random() * 30) + 10,
            memory_usage: Math.floor(Math.random() * 40) + 20,
            connected_sensors: 0,
            last_active: new Date().toISOString(),
            specs: this.getNodeSpecsName(specs)
        };

        this.nodeData[newNode.id] = newNode;
        
        // 关闭模态框
        this.closeModal('addNodeModal');
        
        // 重置表单
        document.getElementById('nodeForm').reset();
        
        // 更新显示
        this.updateAllDisplays();
        
        this.showNotification('成功', `节点 ${name} 已添加`, 'success');
    }

    // AI功能方法
    switchAITab(tabName) {
        // 切换AI标签
        document.querySelectorAll('.ai-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        document.querySelectorAll('.ai-tab-content').forEach(content => {
            content.classList.remove('active');
        });

        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        document.getElementById(`${tabName}-tab`).classList.add('active');
    }

    startAIMonitoring() {
        // 启动AI监控
        setInterval(() => {
            this.performAIAnalysis();
        }, 30000); // 每30秒执行一次AI分析
    }

    performAIAnalysis() {
        if (!this.aiEnabled) return;

        // 模拟AI分析
        const sensors = Object.values(this.sensorData);
        
        // 温度异常检测
        sensors.filter(s => s.type === 'temperature').forEach(sensor => {
            if (sensor.current_value > 28 || sensor.current_value < 18) {
                this.generateWarning({
                    type: 'warning',
                    title: '温度异常',
                    message: `传感器 ${sensor.name} 温度异常: ${sensor.current_value}°C`,
                    sensor_id: sensor.id
                });
            }
        });

        // 湿度异常检测
        sensors.filter(s => s.type === 'humidity').forEach(sensor => {
            if (sensor.current_value > 80 || sensor.current_value < 30) {
                this.generateWarning({
                    type: 'warning', 
                    title: '湿度异常',
                    message: `传感器 ${sensor.name} 湿度异常: ${sensor.current_value}%`,
                    sensor_id: sensor.id
                });
            }
        });
    }

    generateWarning(warningData) {
        const existingWarning = this.warnings.find(w => 
            w.sensor_id === warningData.sensor_id && 
            w.type === warningData.type && 
            !w.resolved
        );

        if (!existingWarning) {
            const newWarning = {
                id: `warn_${Date.now()}`,
                ...warningData,
                timestamp: new Date().toISOString(),
                resolved: false
            };
            
            this.warnings.unshift(newWarning);
            this.updateWarningsDisplay();
            this.updateStats();
            
            // 显示通知
            this.showNotification(warningData.title, warningData.message, warningData.type);
        }
    }

    // 工具方法
    getValueStatusClass(sensor) {
        if (sensor.status !== 'online' || sensor.current_value === null) return '';
        
        if (sensor.type === 'temperature') {
            if (sensor.current_value > 28 || sensor.current_value < 18) return 'danger';
            if (sensor.current_value > 26 || sensor.current_value < 20) return 'warning';
        } else if (sensor.type === 'humidity') {
            if (sensor.current_value > 80 || sensor.current_value < 30) return 'danger';
            if (sensor.current_value > 70 || sensor.current_value < 40) return 'warning';
        }
        
        return 'success';
    }

    getDeviceTypeName(sensorType) {
        const names = {
            'temperature': '温度传感器',
            'humidity': '湿度传感器',
            'light': '光照传感器', 
            'pressure': '压力传感器',
            'camera': '摄像头'
        };
        return names[sensorType] || '未知传感器';
    }

    getDefaultValue(sensorType) {
        const defaults = {
            'temperature': 22.0,
            'humidity': 55.0,
            'light': 500,
            'pressure': 1013.25,
            'camera': null
        };
        return defaults[sensorType] || 0;
    }

    getUnit(sensorType) {
        const units = {
            'temperature': '°C',
            'humidity': '%',
            'light': 'lux',
            'pressure': 'hPa',
            'camera': 'image'
        };
        return units[sensorType] || '';
    }

    getNodeSpecsName(specs) {
        const names = {
            'basic': '基础型 (2核4G)',
            'standard': '标准型 (4核8G)', 
            'advanced': '高级型 (8核16G)'
        };
        return names[specs] || specs;
    }

    generateSampleData(type, count) {
        const baseValues = {
            'temperature': { base: 22, variation: 3 },
            'humidity': { base: 55, variation: 15 },
            'light': { base: 500, variation: 300 }
        };
        
        const config = baseValues[type] || { base: 0, variation: 10 };
        const data = [];
        
        for (let i = count; i > 0; i--) {
            const timestamp = new Date(Date.now() - i * 60000).toISOString();
            const value = config.base + (Math.random() - 0.5) * config.variation;
            data.push([timestamp, Number(value.toFixed(2))]);
        }
        
        return data;
    }

    generateCorrelationData() {
        const data = [];
        for (let i = 0; i < 50; i++) {
            const temp = 18 + Math.random() * 12; // 18-30°C
            const humidity = 40 + (30 - temp) * 1.5 + (Math.random() - 0.5) * 10; // 负相关
            data.push([Number(temp.toFixed(1)), Number(humidity.toFixed(1))]);
        }
        return data;
    }

    formatUptime() {
        const hours = Math.floor((Date.now() - this.startTime) / 3600000);
        return `${hours} 小时`;
    }

    // API调用方法
    async refreshSensorData() {
        try {
            this.showLoading('更新传感器数据...');
            
            // 模拟API调用
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // 更新传感器数据
            Object.values(this.sensorData).forEach(sensor => {
                if (sensor.status === 'online') {
                    const variation = (Math.random() - 0.5) * 2;
                    sensor.current_value = Number((sensor.current_value + variation).toFixed(2));
                    sensor.last_update = new Date().toISOString();
                    
                    // 更新历史数据
                    sensor.history.push([new Date().toISOString(), sensor.current_value]);
                    if (sensor.history.length > 100) {
                        sensor.history = sensor.history.slice(-100);
                    }
                }
            });
            
            this.updateAllDisplays();
            this.hideLoading();
            
            this.showNotification('数据更新', '传感器数据已刷新', 'success');
        } catch (error) {
            this.showNotification('数据更新', '更新失败: ' + error.message, 'error');
            this.hideLoading();
        }
    }

    async checkSystemStatus() {
        try {
            const response = await fetch(`${this.apiBase}/status`);
            const status = await response.json();
            
            // 更新连接状态
            const statusElement = document.getElementById('sensor-connection-status');
            if (statusElement) {
                statusElement.className = 'sensor-status connected';
                statusElement.innerHTML = '<span class="status-indicator"></span><span>后端服务器已连接</span>';
            }
            
            return status;
        } catch (error) {
            const statusElement = document.getElementById('sensor-connection-status');
            if (statusElement) {
                statusElement.className = 'sensor-status disconnected';
                statusElement.innerHTML = '<span class="status-indicator"></span><span>后端服务器未连接</span>';
            }
            throw error;
        }
    }

    // 主题管理
    loadTheme() {
        const savedTheme = StorageManager.get('theme') || 'light';
        this.setTheme(savedTheme);
    }

    setTheme(theme) {
        this.currentTheme = theme;
        document.body.setAttribute('data-theme', theme);
        StorageManager.set('theme', theme);
        
        // 更新主题切换按钮图标
        const themeIcon = document.querySelector('.theme-toggle i');
        if (themeIcon) {
            themeIcon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }
    }

    toggleTheme() {
        const newTheme = this.currentTheme === 'light' ? 'dark' : 'light';
        this.setTheme(newTheme);
    }

    // 工具方法
    showNotification(title, message, type = 'info') {
        const notificationManager = new NotificationManager();
        notificationManager[type](message, 5000);
    }

    showLoading(message = '加载中...') {
        const loading = document.getElementById('global-loading');
        if (loading) {
            loading.style.display = 'flex';
            loading.querySelector('.loading-text').textContent = message;
        }
    }

    hideLoading() {
        const loading = document.getElementById('global-loading');
        if (loading) {
            loading.style.display = 'none';
        }
    }

    startAutoRefresh() {
        // 每10秒自动刷新数据
        setInterval(() => {
            this.refreshSensorData();
        }, 10000);
    }

    closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }

    // 设备操作
    showDeviceDetail(deviceId) {
        const sensor = this.sensorData[deviceId];
        if (sensor) {
            this.showNotification('设备详情', `查看设备: ${sensor.name}`, 'info');
        }
    }

    showDeviceConfig(deviceId) {
        const sensor = this.sensorData[deviceId];
        if (sensor) {
            this.showNotification('设备配置', `配置设备: ${sensor.name}`, 'warning');
        }
    }

    removeDevice(deviceId) {
        if (confirm('确定要删除这个设备吗？此操作不可恢复。')) {
            delete this.sensorData[deviceId];
            this.updateAllDisplays();
            this.showNotification('设备删除', `设备 ${deviceId} 已删除`, 'success');
        }
    }

    resolveWarning(warningId) {
        const warning = this.warnings.find(w => w.id === warningId);
        if (warning) {
            warning.resolved = true;
            this.updateWarningsDisplay();
            this.updateStats();
            this.showNotification('警告处理', '警告已标记为已处理', 'success');
        }
    }

    // 导出功能
    exportData() {
        const sensors = Object.values(this.sensorData);
        const data = sensors.map(sensor => ({
            '设备ID': sensor.id,
            '设备名称': sensor.name,
            '设备类型': this.getDeviceTypeName(sensor.type),
            '状态': sensor.status,
            '位置': sensor.location,
            '当前数值': sensor.current_value,
            '单位': sensor.unit,
            '最后更新': sensor.last_update
        }));
        
        if (PlatformUtils.downloadCSV(data, '传感器数据.csv')) {
            this.showNotification('数据导出', '传感器数据已导出为CSV文件', 'success');
        } else {
            this.showNotification('数据导出', '导出失败', 'error');
        }
    }
}

// ==================== 全局功能函数 ====================
function toggleSidebar() {
    const sidebar = document.querySelector('.sidebar');
    const mainContent = document.querySelector('.main-content');
    sidebar.classList.toggle('collapsed');
    mainContent.style.marginLeft = sidebar.classList.contains('collapsed') ? '80px' : '280px';
}

function toggleTheme() {
    if (window.platform) {
        window.platform.toggleTheme();
    }
}

function showUserMenu() {
    if (window.platform) {
        window.platform.showNotification('用户菜单', '用户设置功能开发中', 'info');
    }
}

function refreshRealtimeData() {
    if (window.platform) {
        window.platform.refreshSensorData();
    }
}

function checkSystemStatus() {
    if (window.platform) {
        window.platform.checkSystemStatus();
    }
}

function exportData() {
    if (window.platform) {
        window.platform.exportData();
    }
}

function openModal(modalId) {
    document.getElementById(modalId).style.display = 'block';
}

function closeModal(modalId) {
    if (window.platform) {
        window.platform.closeModal(modalId);
    }
}

function openAIAnalysis() {
    openModal('aiAnalysisModal');
}

function generateReport() {
    if (window.platform) {
        window.platform.showNotification('报告生成', '数据分析报告生成中...', 'info');
        // 模拟报告生成
        setTimeout(() => {
            window.platform.showNotification('报告生成', '数据分析报告已生成', 'success');
        }, 2000);
    }
}

function scanDevices() {
    if (window.platform) {
        window.platform.showNotification('设备扫描', '正在扫描可用设备...', 'warning');
    }
}

function syncNodes() {
    if (window.platform) {
        window.platform.showNotification('节点同步', '正在同步节点状态...', 'info');
    }
}

function deployAI() {
    if (window.platform) {
        window.platform.showNotification('AI部署', '正在部署AI模型到边缘节点...', 'info');
    }
}

function clearReadWarnings() {
    if (window.platform && confirm('确定要清空所有已读警告吗？')) {
        window.platform.warnings = window.platform.warnings.filter(w => !w.resolved);
        window.platform.updateWarningsDisplay();
        window.platform.updateStats();
        window.platform.showNotification('警告清理', '已读警告已清空', 'success');
    }
}

function openAlertSettings() {
    if (window.platform) {
        window.platform.showNotification('告警设置', '打开告警设置面板', 'info');
    }
}

function saveConfig() {
    if (window.platform) {
        window.platform.showNotification('配置保存', '系统配置已保存', 'success');
    }
}

function restartServices() {
    if (window.platform && confirm('确定要重启所有服务吗？这可能会暂时中断数据采集。')) {
        window.platform.showNotification('服务重启', '正在重启系统服务...', 'warning');
    }
}

function backupSystem() {
    if (window.platform) {
        window.platform.showNotification('系统备份', '正在创建系统备份...', 'info');
    }
}

function exportAnalytics() {
    if (window.platform) {
        window.platform.showNotification('分析导出', '分析数据导出功能开发中', 'info');
    }
}

function bulkOperations() {
    if (window.platform) {
        window.platform.showNotification('批量操作', '批量操作功能开发中', 'info');
    }
}

// 页面导航功能
function initPageNavigation() {
    const navItems = document.querySelectorAll('.nav-item');
    const pages = document.querySelectorAll('.page');
    const pageTitle = document.getElementById('page-title');

    navItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            
            navItems.forEach(nav => nav.classList.remove('active'));
            this.classList.add('active');
            
            const targetPage = this.getAttribute('data-page');
            pages.forEach(page => {
                page.classList.remove('active');
                if (page.id === targetPage) {
                    page.classList.add('active');
                }
            });
            
            const pageTitles = {
                'dashboard': '物联网平台监控中心',
                'devices': '设备管理',
                'analytics': '智能数据分析',
                'edge-nodes': '边缘节点管理',
                'warnings': '智能警告中心',
                'system': '系统管理'
            };
            pageTitle.textContent = pageTitles[targetPage];
        });
    });

    // 统计卡片点击跳转
    document.querySelectorAll('.stat-card').forEach(card => {
        card.addEventListener('click', function() {
            const targetPage = this.getAttribute('data-target');
            const targetNav = document.querySelector(`[data-page="${targetPage}"]`);
            if (targetNav) {
                targetNav.click();
            }
        });
    });
}

// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', function() {
    // 初始化平台
    window.platform = new EdgePlatform();
    
    // 初始化页面导航
    initPageNavigation();
    
    // 记录启动时间
    window.platform.startTime = Date.now();
});

// 窗口调整大小时重绘图表
window.addEventListener('resize', function() {
    if (window.platform && window.platform.charts) {
        Object.values(window.platform.charts).forEach(chart => {
            if (chart && chart.resize) {
                chart.resize();
            }
        });
    }
});
</script>
        console.log("平台初始化中...");
    </script>
</body>
</html>